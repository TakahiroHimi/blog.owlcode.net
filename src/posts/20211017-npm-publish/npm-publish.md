---
created: '2020-10-17'
updated: ''
title: npmパッケージを作って公開する
visual: 'npm'
tags: ['npm', 'TypeScript']
---

npmの仕組み理解の筋トレとして**パッケージを作って公開した**。

<https://www.npmjs.com/package/ogp-fetcher>

<https://github.com/TakahiroHimi/ogp-fetcher/tree/main>  

ライブラリの実装についてはまた別の記事にする。  

筋トレのためと書いたが実際にこのブログでも使用しており、**つまりこのパッケージにバグがあるとこのブログもバグる**ので、今後もそれなりに運用していく。  

今後また何か作るかもしれないので公開までの手順や悩んだ箇所を記録しておく。  

&nbsp;

## GitHub Packages
GitHubには**GitHub Packages**という**GitHubとnpmを連携できる**サービスがある。  

<https://docs.github.com/ja/packages/learn-github-packages/introduction-to-github-packages>  

<https://docs.github.com/ja/packages/working-with-a-github-packages-registry/working-with-the-npm-registry>  

リポジトリのサイドメニューの**Packages**ってやつ。  

![GitHubPackages](https://raw.githubusercontent.com/TakahiroHimi/blog.owlcode.net/main/src/posts/20211017-npm-publish/githubPackages.png)  

「こんなに目立つところにあるし設定した方が良いのかな」と思い色々調べてみたが、**結論としては使わなかった**。  
理由としては**パッケージのインストールにGitHubのアクセストークンが必要になったり**、**公開するパッケージがスコープ付きに限定される**から。  
後者に関してはパッケージの名前が`@TakahiroHimi/ogp-fetcher`になるようなイメージ。  
インストール時のコマンドも`yarn add @TakahiroHimi/ogp-fetcher`となる。  

パッケージの名前にスコープがついているということは**スコープ違いで同名のパッケージが存在する可能性もある**ので、インストール時に「今からインストールしようとしているのは本当に自分が入れたいパッケージだろうか」と気になることがあるので避けたかった。  
もちろんスコープ無しのパッケージについてもスコープありの同名が存在する可能性はあるが、なんとなく スコープ無し＝オリジナル 感があるのでその場合は気になったことはない(個人の感想)。  

使ってる人の事例記事も何個か見つけて読んだが、総じて「社内用パッケージを公開するのに便利」などの言及が多く**パブリックなものを公開する際にはあまり使用していない**ようだった。  
そもそもそういうものなのかもしれない。  

&nbsp;

## npmに公開する  
「npm パッケージ 公開」で検索すると手順を説明している記事は大量に出てくるので細かい手順は書かないが、参考にした記事と悩んだポイントだけ記録しておく。  

参考にした記事
<https://numb86-tech.hatenablog.com/entry/2019/06/28/220736>


### build結果の出力先  
上記に挙げた記事では`tsconfig.json`の`outDir`を`./dist`に設定しており、ビルド結果が`./dist`に出力される。  
個人的にもこの構成が綺麗だと思っていたが、npm公開手順の説明記事で**この設定をしていない記事が中々多く**、一般的では無いのかと少し悩んだ。  
ちなみに上記設定をしていない場合ビルド結果が`./src`配下にぶちまけられる。  
`./dist`に出力して`.gitignore`でgit管理対象外にしておくのが一番綺麗なのではと思っているが、それ以外により良い構成があれば知りたい。  

少し気になっているのはこの構成だと`yarn add`でインストールした際に落ちてくるフォルダの中にも`./dist`ディレクトリができてしまい、パッケージ作成者側の都合を利用者に押し付けてる感があるかなと少しだけ思っている。  
ただ普段自分が使っているパッケージの構成を見ると割と色々あったので(`./dist`があるものも結構あった)、気にするようなところでは無いのかもしれない。  


### npm publishが失敗する
ソースを書いて`npm publish`を実行しても403エラーで失敗してしまった。  
原因は**npmにSignUpした後に送られてくるメール認証をしていなかったから**。  
しょうもないミス。  

&nbsp;

## End

npmへのパッケージ公開は**かなり良い筋トレだった**と思う。  
`package.json`と`tsconfig.json`について**どこをいじればどう変わるか実際に手を動かしながら確認できて理解が深まった**。  
`package.json`の`description`や`files`など「これはどう使うんだろう」と気になりつつ目を背けてた項目もちゃんと理解できた。  

一番大きな収穫としてはパッケージのソースを読む時に**目的の処理を探すまでの時間が短くなった**と思う。  
今までは適当に当たりをつけつつソースを流し見して自分が見たい処理を探したり、なんとなくそれっぽいキーワードで検索してみたりしていたので、それと比べると大きな進歩だった。  

